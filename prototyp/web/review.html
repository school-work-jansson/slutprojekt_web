<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>

    <script src="https://kit.fontawesome.com/3e0ba644be.js" crossorigin="anonymous"></script>
    <!-- 
        Detta exempel används för att simulera en "preview" på en review som en användare ska skicka in. 
        Så att användaren ser hur posten kommer se ut när den är publicerad.
     -->
</head>
<body>
    <style>
        * {
            margin: 0;
            margin:10px;
        }
        
        textarea
        {
            resize: none;
            
        }

        .rating__star {
            color: #dabd18b2;
        }

        #preview {
            background-color: grey;
    
            border-radius: 5px;

            padding:10px;

            max-width: 750px;
        }

        #preview  p {
            word-wrap: break-word;
        }
    </style>
    
    <div id="form">
        <!-- 
            Om det användaren skickar är identiskt till något som redan är publicerat så ska det flaggas
            Om användaren använder massa svordommar i sin text så bör den också flaggas automatiskt

            Om någonting flaggas så ska den inte publiceras utan den ska bli manuellt accepterad av en admin
            Detta fungerar inte för på en skalad nivå, tex om sidan skulle få 200.000 dagliga användare
          -->
        
        <input type="text" id="name" placeholder="Name">
        <input type="text" id="title" placeholder="Title">
        <textarea cols="60" rows="10" id="content" placeholder="Content"></textarea>
        <!-- 
            https://www.w3schools.com/howto/tryit.asp?filename=tryhow_css_star_rating 
            https://www.w3schools.com/howto/howto_css_star_rating.asp
        -->

        <div class="rating">
            <i class="rating__star far fa-star"></i>
            <i class="rating__star far fa-star"></i>
            <i class="rating__star far fa-star"></i>
            <i class="rating__star far fa-star"></i>
            <i class="rating__star far fa-star"></i>
        </div>

        <input type="submit" id="send_review_button" value="Submit">
        
    </div>
<!-- Formatering ? -->
    <div id="preview">
        <h1 id="preview-title"></h1> 
        <span id="preview-name"></span>
        <span id="preview-date"></span>
        <p id="preview-content"></p>
        <div class="rating">
            <i class="preview__rating__star far fa-star"></i>
            <i class="preview__rating__star far fa-star"></i>
            <i class="preview__rating__star far fa-star"></i>
            <i class="preview__rating__star far fa-star"></i>
            <i class="preview__rating__star far fa-star"></i>
        </div>
    </div>
    
    <script>
        let review_object = {
                title: "",
                content: "",
                name: "",
                date: getDate(),
                rating: 0
            }

        $(() => {
            

            $('#title').on('input', () => {
                let title_value = $("#title").val()
                $("#preview-title").html(title_value)
                $("#preview-date").html(getDate())
                review_object.title = title_value
            });

            $('#content').on('input', () => {
                let content_value = $("#content").val()
                $("#preview-content").html(content_value)

                $("#preview-date").html(getDate())

                review_object.title = content_value
            });

            $('#name').on('input', () => {
                let name_valie = $("#name").val()
                $("#preview-name").html(name_valie)
                $("#preview-date").html(getDate())
                review_object.name = name_valie
            });


            /* Star-rating Inspiration (https://codepen.io/Leoschmittk/pen/OJbQBgb) */
            const star_whole = "rating__star fas fa-star";
            const star_half = "raiting__star fas fa-star-half-alt"
            const star_none = "rating__star far fa-star";

            // Mappar alla raiting__star iconerna till en array
            let stars = $('.rating__star').map((_, element) => {return element}).get()
            
            
            console.log("DEBUG: ", stars)

            // på något sätt fungerar detta för att ändra mängden stjärnor
            // När en användare clickar på 
            $(stars).each((star_index) => {
                $(stars[star_index]).click(() => {
                    let i = star_index;
                    review_object.rating = (star_index + 1) // Index av den stjärnan som användaren klickar på plus ett

                    if ( !$(stars[star_index]).hasClass(star_whole) )
                    {
                        for (i; i >= 0; --i)
                            $(stars[i]).attr("class", star_whole)
                        
                    }   
                    else {
                        for (i; i < stars.length; i++)
                            $(stars[i]).attr("class", star_none)
                        
                    }

                    update_preview_stars(review_object.rating)
                    
                    console.log("Current rating", review_object.rating)
                    

                })
            })



            console.log("Current rating", review_object.rating)

            $("#send_review_button").click(() => {
                $.post("/send_review", review_object)
                console.log("posted")
            })

            

        })
        function update_preview_stars(rating)
        {
            console.log("update_preview_stars", rating)

            const preview_star_whole = "preview__rating__star fas fa-star";
            const preview_star_none = "preview__rating__star far fa-star";

            let preview_stars = $('.preview__rating__star').map((_, element) => {return element}).get()
            
            $(preview_stars).each((star_index) => {
                let i = rating - 1
                
                if ( $(preview_stars[i]).hasClass(preview_star_whole) )
                {
                    for (i; i < preview_stars.length; i++)
                        $(preview_stars[i]).attr("class", preview_star_none)
                }
                else {
                    for (i; i >= 0; --i)
                        $(preview_stars[i]).attr("class", preview_star_whole)
                }
                
            })   

        }

        function getDate() {
            return new Date().toISOString()
        }



    </script>
</body>
</html>